# LuckPermsからの移行ガイド

IronDiscipline通常版（LuckPerms依存版）からIronDiscipline-dev（LuckPerms非依存版）へのデータ移行手順です。

## 概要

IronDiscipline-devでは、階級データを独自のデータベース（H2/MySQL）に保存します。
通常版ではLuckPermsのメタデータに保存されていたため、移行が必要です。

## 移行手順

### 1. 準備

1. サーバーを停止
2. `plugins/IronDiscipline.jar` を削除
3. `plugins/IronDiscipline-dev-latest.jar` を配置
4. **重要**: LuckPermsプラグインは**削除しないで**ください（移行時に必要）

### 2. サーバー起動

```bash
./start.sh
```

または

```bash
java -jar server.jar
```

### 3. 移行コマンド実行

サーバーコンソールまたは管理者権限を持つプレイヤーで実行：

```
/irondev migrate
```

以下のような出力が表示されます：

```
対象ユーザー数: 150
進捗: 10% (15/150)
進捗: 20% (30/150)
...
===========================
移行完了！
移行したユーザー数: 142
===========================
```

### 4. 確認

```
/irondev status
```

移行されたデータ件数が表示されます。

### 5. LuckPerms削除（オプション）

移行が正常に完了したことを確認後、LuckPermsを削除できます。

```bash
rm plugins/LuckPerms*.jar
```

## トラブルシューティング

### 「LuckPermsが見つかりません」エラー

LuckPermsプラグインがpluginsフォルダに存在することを確認してください。
移行が完了するまでLuckPermsは削除しないでください。

### 一部のユーザーが移行されない

LuckPermsに階級メタデータ（デフォルト: `rank`）が設定されていないユーザーはスキップされます。
これらのユーザーは初回ログイン時に自動的にPRIVATE（二等兵）として登録されます。

### 移行後も階級が表示されない

1. プレイヤーに再ログインしてもらう
2. または `/iron reload` で設定をリロード

## 通常版との並行運用

通常版と同じサーバーで並行運用することは**推奨しません**。
データの不整合が発生する可能性があります。

別サーバーでテスト後、本番環境で移行することを推奨します。
